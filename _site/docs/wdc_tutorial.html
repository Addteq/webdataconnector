<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>WDC Tutorial</title>
  <meta name="description" content="Connect to your web data from Tableau.">

  <link rel="shortcut icon" type="image/png" href="/assets/logo.png">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/api_ref.css">
  <link rel="stylesheet" href="/css/github-highlight.css">
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</head>

  <body>
    <div class="container">
        <header class="site-header">
  <div class="wrapper">
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand navbar-brand-logo" href="/#">Tableau Web Data Connector</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/docs/">Docs</a></li>
            <li><a href="/ref/api_ref">API Reference</a></li>
            <li><a href="/community/community_home">Community Connectors</a></li>
            <li><a href="/news/news_home">What's New?</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li class="tableauIcon"><a target="_blank" href="http://tableau.com"><img src="/assets/logo.png" alt="Tableau Developers" class="logo" /></a></li>
            <li><a target="_blank" href="https://github.com/tableau/webdataconnector"><span class="icon icon--github" title="WDC on GitHub" alt="WDC on GitHub"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span></a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  </div>
</header>

        
            <html class="minimal">
<body>
<nav class="tsd-navigation secondary">
	<ul>
		<li>
			<h5>Overview</h5>
			<ul>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs" class="tsd-kind-icon">Get Started</a>
				</li>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_tutorial" class="tsd-kind-icon">Tutorial</a>
				</li>
                <li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_use_in_tableau" class="tsd-kind-icon">Use a WDC in Tableau</a>
				</li>
            </ul>
        </li>
        <li>
			<h5>Basic Concepts</h5>
			<ul>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_phases" class="tsd-kind-icon">WDC Lifecycle and Phases</a>
				</li>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_simulator" class="tsd-kind-icon">Simulator and Samples</a>
				</li>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_library_versions" class="tsd-kind-icon">API Versioning</a>
				</li>
                <li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_hosting_and_submissions" class="tsd-kind-icon">Hosting and Submitting to Community Portal</a>
				</li>
            </ul>
        </li>
        <li>
			<h5>Advanced Concepts</h5>
			<ul>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_custom_init_and_shutdown" class="tsd-kind-icon">Custom Initialization and Shutdown</a>
				</li>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_incremental_refresh" class="tsd-kind-icon">Incremental Refresh</a>
				</li>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_authentication" class="tsd-kind-icon">WDC Authentication</a>
				</li>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_cors" class="tsd-kind-icon">Working with CORS</a>
				</li>
			</ul>
        </li>
        <li>
			<h5>Advanced Tutorials</h5>
			<ul>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_multi_table_tutorial" class="tsd-kind-icon">Multi Table Tutorial</a>
				</li>
				<!--<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_oauth_tutorial" class="tsd-kind-icon">Node Proxy with OAuth 2.0 Tutorial</a>
				</li>-->
            </ul>
        </li>
        <li>
			<h5>Reference</h5>
			<ul>
				<!--<li class="tsd-kind-property tsd-parent-kind-class">
					<a target="_blank" href="/ref/api_ref" class="tsd-kind-icon">API Reference</a>
                </li>-->
                <li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_ref_date_formats" class="tsd-kind-icon">Supported Date Formats</a>
				</li>
				<!--<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_resources" class="tsd-kind-icon">Resources</a>
				</li>-->
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_faq" class="tsd-kind-icon">FAQ</a>
				</li>
            </ul>
        </li>
    <ul>
</nav>
<div class="content-wrap docs-content-wrap">
    <h1>WDC Tutorial</h1>
    <article class="post">

  <div class="post-content">
    <blockquote>
  <p>This tutorial picks up where the <a href="/docs">Get Started</a> topic left off. If you haven’t already, go back and set up your development environment.</p>
</blockquote>

<h2 id="what-youll-build">What you’ll build</h2>

<p>By the end of this tutorial, you’ll have a working WDC that connects to the <a href="http://earthquake.usgs.gov/earthquakes/feed/v1.0/index.php">USGS Earthquake feed</a> and downloads data for earthquakes that occurred in the last week.</p>

<p>You’ll learn how to:</p>

<ul>
  <li><a href="#create-page">Create the HTML page</a></li>
  <li><a href="#create-connector-obj">Create the connector object</a></li>
  <li><a href="#event-listener">Add an event listener</a> to respond to user interaction</li>
  <li><a href="#test-so-far">Test the connector</a></li>
  <li><a href="#define-schema">Define a schema</a> which maps web data to table columns</li>
  <li><a href="#get-data">Get the data</a> for a single table</li>
  <li><a href="#see-in-action">See it in action</a></li>
</ul>

<p>If you <em>really</em> want to skip all of this and go straight to the source code, look for the <code class="highlighter-rouge">earthquakeUSGS</code> files in the <code class="highlighter-rouge">Examples</code> directory and the <code class="highlighter-rouge">js</code> directory. You’ll get a lot more out of this if you build it from scratch though–promise!</p>

<h3 id="create-page">Create the HTML page</h3>

<p>When you open a WDC in Tableau, you display an HTML page that links to your JavaScript code and to the WDC library. Optionally, this page can also display a user interface for your users to select the data that they want to download.</p>

<p>Create a new file named <code class="highlighter-rouge">earthquakeWDC.html</code> and save it in the top-level directory of the <code class="highlighter-rouge">webdataconnector</code> repository. (In the same directory as the README.)</p>

<p>Then, copy the following code into the file:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>USGS Earthquake Feed<span class="nt">&lt;/title&gt;</span>
    
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"Cache-Control"</span> <span class="na">content=</span><span class="s">"no-store"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://connectors.tableau.com/libs/tableauwdc-2.0.0-beta.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"earthquake.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
   
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"submitButton"</span> <span class="na">type=</span><span class="s">"button"</span><span class="nt">&gt;</span>Get Earthquake Data!<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<p>Let’s run through what the code is doing. Skipping over the standard markup for an HTML page, you’ll notice the following between the <code class="highlighter-rouge">head</code> tags:</p>

<ul>
  <li>The <code class="highlighter-rouge">meta</code> tag prevents your browser from caching the page.</li>
  <li>The <code class="highlighter-rouge">jquery.min.js</code> file will be used as a helper library by our connector. (For example, the connector uses jquery to get JSON data.)</li>
  <li>The <code class="highlighter-rouge">tableauwdc-2.0.0-beta.js</code> file is the main library for the WDC API.</li>
  <li>The <code class="highlighter-rouge">earthquake.js</code> file is the (not yet created) JavaScript code for our connector.</li>
</ul>

<p>Between the <code class="highlighter-rouge">body</code> tags, there is a simple button element that illustrates how users can interact with your connector before getting data. In a later step, you’ll attach an event listener to the button in the JavaScript code.</p>

<h3 id="create-connector-obj">Create the connector object</h3>

<p>Now that you’ve created a user interface, it’s time to write the JavaScript code for the connector. Create a new file named <code class="highlighter-rouge">earthquakeWDC.js</code> and save it in the same directory as the <code class="highlighter-rouge">earthquakeWDC.html</code> file.</p>

<p>Copy the following code into the file to create the basic structure of the connector:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">myConnector</span> <span class="o">=</span> <span class="nx">tableau</span><span class="p">.</span><span class="nx">makeConnector</span><span class="p">();</span>
 
    <span class="nx">myConnector</span><span class="p">.</span><span class="nx">getSchema</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">schemaCallback</span><span class="p">)</span> <span class="p">{</span>
 
    <span class="p">};</span>
 
    <span class="nx">myConnector</span><span class="p">.</span><span class="nx">getData</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">doneCallback</span><span class="p">)</span> <span class="p">{</span>
        
    <span class="p">};</span>
 
    <span class="nx">tableau</span><span class="p">.</span><span class="nx">registerConnector</span><span class="p">(</span><span class="nx">myConnector</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre>
</div>

<p>Some things to note about the code:</p>

<ul>
  <li>The code is wrapped in an immediately invoked function expression to create a local scope.</li>
  <li>The <code class="highlighter-rouge">tableau</code> object isn’t defined in our code, but in the WDC library. (It’s assigned to the global scope.)</li>
  <li>The <code class="highlighter-rouge">makeConnector</code> function is a constructor that predefines some methods for our connector object.</li>
  <li>The <code class="highlighter-rouge">getSchema</code> and <code class="highlighter-rouge">getData</code> functions are placeholders for now, but will contain the logic for getting the table schema of the data and downloading the data.</li>
  <li>The <code class="highlighter-rouge">registerConnector</code> function validates the connector object before initialization.</li>
</ul>

<h3 id="event-listener">Add an event listener</h3>

<p>Remember how we added a button to the HTML page? It’s time to create an event listener that responds to clicking on the button.</p>

<p>Copy the following code and paste it directly below the <code class="highlighter-rouge">registerConnector</code> function:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">"#submitButton"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">tableau</span><span class="p">.</span><span class="nx">connectionName</span> <span class="o">=</span> <span class="s2">"USGS Earthquake Feed"</span><span class="p">;</span>
        <span class="nx">tableau</span><span class="p">.</span><span class="nx">submit</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre>
</div>

<p>Here’s what is going on in the code snippet:</p>

<ul>
  <li>The jquery <code class="highlighter-rouge">$(document).ready</code> function runs some code when the page loads.</li>
  <li>An click event listener is added to the button element created earlier. The button is identified by the <code class="highlighter-rouge">submitButton</code> id.</li>
  <li>The <code class="highlighter-rouge">tableau.connectionName</code> variable defines what we want to call the connector data source when it is displayed in Tableau.</li>
  <li>The <code class="highlighter-rouge">tableau.submit()</code> function sends the connector object to Tableau for validation.</li>
</ul>

<p><strong>Note</strong>: Not every connector needs a user interface. If you want a connector to run without user input, you can use custom initialization code. For more information, see <a href="/docs/wdc_custom_init_and_shutdown">Custom Initialization and Shutdown</a>.</p>

<h3 id="test-so-far">Test the connector so far</h3>

<p>The connector doesn’t <em>do</em> very much so far, but it’s enough that we can run it in the simulator.</p>

<p><strong>Note</strong>: Have you followed the steps in the <a href="/docs">Get Started</a> topic to run the simulator? This section assumes that you’ve installed dependencies already.</p>

<ol>
  <li>Open a command prompt or terminal in the top-level directory for the <code class="highlighter-rouge">webdataconnector</code> repository.</li>
  <li>Run <code class="highlighter-rouge">npm start</code> to run the test server.</li>
  <li>
    <p>Open a browser and navigate to the following URL:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>http://localhost:8000/Simulator/index.html 
</code></pre>
    </div>
  </li>
  <li>
    <p>In the WDC URL field, enter the path to your WDC relative to the simulator. For example, if you created your WDC in the top-level directory, you might enter:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>../earthquakeWDC.html
</code></pre>
    </div>
  </li>
  <li>Click the <strong>Start Interactive Phase</strong> button.
The connector page appears in a new window.</li>
  <li>Click <strong>Get Earthquake Data!</strong>.
The connector page closes.</li>
</ol>

<p>At this point, you might be thinking “Well…did it work?” Let’s add a log message so that you can practice debugging the connector.</p>

<ol>
  <li>
    <p>In the <code class="highlighter-rouge">earthquakeWDC.js</code> file, copy the following code and replace the empty <code class="highlighter-rouge">myConnector.getSchema</code> function:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code><span class="nx">myConnector</span><span class="p">.</span><span class="nx">getSchema</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">schemaCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">tableau</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Hello WDC!"</span><span class="p">);</span>
<span class="p">};</span>
</code></pre>
    </div>
    <p>The <code class="highlighter-rouge">tableau.log</code> function allows you to pass messages from your connector back to the simulator. These log messages are then printed with the browser’s built-in <code class="highlighter-rouge">console.log()</code> function on the simulator page.</p>
  </li>
  <li>Refresh the simulator page in your browser.</li>
  <li>Open your browser’s developer tools. For example, in Chrome you can press <strong>Ctrl+Shift+I</strong>.</li>
  <li>Click <strong>Start Interactive Phase</strong>.</li>
  <li>Click <strong>Get Earthquake Data!</strong>.</li>
</ol>

<p>If all goes well, you should see <code class="highlighter-rouge">Hello WDC!</code> in your browser’s console.</p>

<h3 id="define-schema">Define a schema</h3>

<p>So the connector is working now–sort of. Before you can download data and pass it to Tableau, you need to define how you want to map the data to one or more or tables. This mapping of data is done in the schema.</p>

<p>To decide what data you want to map in the schema, you can take a look at a description of the JSON data source <a href="http://earthquake.usgs.gov/earthquakes/feed/v1.0/geojson.php">here</a>. Rather than map all the data available from the data source, this example has selected a focused subset.</p>

<p>When you’re done looking at the summary of the JSON data source, copy the following code into the <code class="highlighter-rouge">earthquakeWDC.js</code> file and replace the placeholder <code class="highlighter-rouge">getSchema</code> function:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nx">myConnector</span><span class="p">.</span><span class="nx">getSchema</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">schemaCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span> <span class="na">id</span> <span class="p">:</span> <span class="s2">"mag"</span><span class="p">,</span> <span class="na">alias</span> <span class="p">:</span> <span class="s2">"magnitude"</span><span class="p">,</span> <span class="na">dataType</span> <span class="p">:</span> <span class="nx">tableau</span><span class="p">.</span><span class="nx">dataTypeEnum</span><span class="p">.</span><span class="kr">float</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">id</span> <span class="p">:</span> <span class="s2">"title"</span><span class="p">,</span> <span class="na">alias</span> <span class="p">:</span> <span class="s2">"title"</span><span class="p">,</span> <span class="na">dataType</span> <span class="p">:</span> <span class="nx">tableau</span><span class="p">.</span><span class="nx">dataTypeEnum</span><span class="p">.</span><span class="nx">string</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">id</span> <span class="p">:</span> <span class="s2">"url"</span><span class="p">,</span> <span class="na">alias</span> <span class="p">:</span> <span class="s2">"url"</span><span class="p">,</span> <span class="na">dataType</span> <span class="p">:</span> <span class="nx">tableau</span><span class="p">.</span><span class="nx">dataTypeEnum</span><span class="p">.</span><span class="nx">string</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">id</span> <span class="p">:</span> <span class="s2">"lat"</span><span class="p">,</span> <span class="na">alias</span> <span class="p">:</span> <span class="s2">"latitude"</span><span class="p">,</span> <span class="na">dataType</span> <span class="p">:</span> <span class="nx">tableau</span><span class="p">.</span><span class="nx">dataTypeEnum</span><span class="p">.</span><span class="kr">float</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">id</span> <span class="p">:</span> <span class="s2">"lon"</span><span class="p">,</span> <span class="na">alias</span> <span class="p">:</span> <span class="s2">"longitude"</span><span class="p">,</span> <span class="na">dataType</span> <span class="p">:</span> <span class="nx">tableau</span><span class="p">.</span><span class="nx">dataTypeEnum</span><span class="p">.</span><span class="kr">float</span> <span class="p">}</span>
    <span class="p">];</span>

    <span class="kd">var</span> <span class="nx">tableInfo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">id</span> <span class="p">:</span> <span class="s2">"earthquakeFeed"</span><span class="p">,</span>
        <span class="na">alias</span> <span class="p">:</span> <span class="s2">"Earthquakes with magnitude greater than 4.5 in the last seven days"</span><span class="p">,</span>
        <span class="na">columns</span> <span class="p">:</span> <span class="nx">cols</span>
    <span class="p">};</span>

    <span class="nx">schemaCallback</span><span class="p">([</span><span class="nx">tableInfo</span><span class="p">]);</span>
<span class="p">};</span>
</code></pre>
</div>

<p>Here’s what’s going on in the code:</p>

<ul>
  <li>The <code class="highlighter-rouge">getSchema</code> function takes a <code class="highlighter-rouge">schemaCallback</code> parameter which is defined by the WDC API.</li>
  <li>The <code class="highlighter-rouge">cols</code> variable contains an array of JavaScript objects, where each object defines a single column in our table. In this example, there are columns for magnitude, title, latitude, and longitude.</li>
  <li>The <code class="highlighter-rouge">tableInfo</code> variable defines the schema for a single table and contains a JavaScript object. Here, the value of the <code class="highlighter-rouge">columns</code> property is set to the <code class="highlighter-rouge">cols</code> array defined earlier.</li>
  <li>The <code class="highlighter-rouge">schemaCallback</code> gets called when the schema is defined. The <code class="highlighter-rouge">schemaCallback</code> takes an array of table objects. In this case, there is only table object (the <code class="highlighter-rouge">tableInfo</code> object defined above).</li>
</ul>

<p><strong>Note</strong>: The <a href="/ref/api_ref">API Reference</a> describes the properties that you can define for the table object and for each object in the table columns in more detail. For now, let’s plunge ahead to the exciting part–getting the data!</p>

<h3 id="get-data">Get the data</h3>

<p>Once the schema is defined, you can begin getting data and passing it to Tableau.</p>

<p>Copy the following code and replace the placeholder <code class="highlighter-rouge">getData</code> function:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nx">myConnector</span><span class="p">.</span><span class="nx">getData</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">doneCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">title</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span>
        <span class="nx">lat</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">lon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s2">"http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_week.geojson"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">feat</span> <span class="o">=</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">features</span><span class="p">;</span> 

        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">feat</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">mag</span> <span class="o">=</span> <span class="nx">feat</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">properties</span><span class="p">.</span><span class="nx">mag</span><span class="p">;</span>
            <span class="nx">title</span> <span class="o">=</span> <span class="nx">feat</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">properties</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
            <span class="nx">url</span> <span class="o">=</span> <span class="nx">feat</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">properties</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
            <span class="nx">lon</span> <span class="o">=</span> <span class="nx">feat</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="nx">lat</span> <span class="o">=</span> <span class="nx">feat</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

            <span class="nx">table</span><span class="p">.</span><span class="nx">appendRows</span><span class="p">({</span>
                <span class="s2">"mag"</span> <span class="p">:</span> <span class="nx">mag</span><span class="p">,</span>
                <span class="s2">"title"</span> <span class="p">:</span> <span class="nx">title</span><span class="p">,</span>
                <span class="s2">"url"</span> <span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
                <span class="s2">"lon"</span> <span class="p">:</span> <span class="nx">lon</span><span class="p">,</span>
                <span class="s2">"lat"</span> <span class="p">:</span> <span class="nx">lat</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="nx">doneCallback</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">};</span>
</code></pre>
</div>

<p>Whew! That’s a good-sized chunk of code. Let’s see what’s happening:</p>

<ul>
  <li>The <code class="highlighter-rouge">getData</code> function takes two parameters: <code class="highlighter-rouge">table</code> and <code class="highlighter-rouge">doneCallback</code>. The <code class="highlighter-rouge">table</code> parameter is an object defined by the WDC to which you can append data. The <code class="highlighter-rouge">doneCallback</code> signals to Tableau that you are done getting data.</li>
  <li>The next few lines declare some local variables.</li>
  <li>The jquery <code class="highlighter-rouge">$.getJSON</code> function gets earthquake data from the USGS earthquake feed and stores the data in a <code class="highlighter-rouge">resp</code>, or response, parameter. (You can open the URL in a browser to see what the JSON data looks like.)</li>
  <li>The for loop iterates over the features in the JSON object and stores the data that we want in the local variables created earlier.</li>
  <li>The <code class="highlighter-rouge">table.appendRows</code> function appends each row of data to the table as a JavaScript object.</li>
</ul>

<h3 id="see-in-action">See it in action</h3>

<p>By now, you’re a pro at running the simulator, so fire it up, load your connector, and click <strong>Get Earthquake Data!</strong> like before. Now that we have a <code class="highlighter-rouge">getSchema</code> function properly defined, you should see the schema displayed in the simulator.</p>

<p>The moment you’ve been waiting for is here! Click <strong>Fetch Table Data</strong> to run your <code class="highlighter-rouge">getData</code> function and display the results in a table.</p>

<p><img src="/assets/wdc_sim_earthquake_data.png" alt="&quot;The earthquake data is displayed in a table on the simulator page.&quot;" width="700px" /></p>

<p>You did it! Nice work. But this is no time to rest on your laurels–<a href="/docs/wdc_use_in_tableau">try your connector in Tableau</a>, dig into the <code class="highlighter-rouge">Examples</code> directory to see more connectors, or read through the WDC documentation. You might want to start by learning about <a href="/docs/wdc_multi_table_tutorial">connectors with multiple tables</a>, <a href="/docs/wdc_incremental_refresh">incremental refresh</a>, and <a href="/docs/wdc_authentication">authentication</a>.</p>

<p>Better yet, dive right in and create your own connector!</p>


  </div>

</article>

</div>
<script src="/js/api_ref.min.js"></script>
<script src="/js/extra.js"></script>
</body>
</html> 

        
        
    </div> 
  </body>
</html>

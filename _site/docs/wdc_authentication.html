<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>WDC Authentication</title>
  <meta name="description" content="Connect to your web data from Tableau.">

  <link rel="shortcut icon" type="image/png" href="/assets/logo.png">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/api_ref.css">
  <link rel="stylesheet" href="/css/github-highlight.css">
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</head>

  <body>
    <div class="container">
        <header class="site-header">
  <div class="wrapper">
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand navbar-brand-logo" href="/#">Tableau Web Data Connector</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/docs/">Docs</a></li>
            <li><a href="/ref/api_ref">API Reference</a></li>
            <li><a href="/community/community_home">Community Connectors</a></li>
            <li><a href="/news/news_home">What's New?</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li class="tableauIcon"><a target="_blank" href="http://tableau.com"><img src="/assets/logo.png" alt="Tableau Developers" class="logo" /></a></li>
            <li><a target="_blank" href="https://github.com/tableau/webdataconnector"><span class="icon icon--github" title="WDC on GitHub" alt="WDC on GitHub"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span></a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  </div>
</header>

        
            <html class="minimal">
<body>
<nav class="tsd-navigation secondary">
	<ul>
		<li>
			<h5>Overview</h5>
			<ul>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs" class="tsd-kind-icon">Get Started</a>
				</li>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_tutorial" class="tsd-kind-icon">Tutorial</a>
				</li>
                <li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_use_in_tableau" class="tsd-kind-icon">Use a WDC in Tableau</a>
				</li>
            </ul>
        </li>
        <li>
			<h5>Basic Concepts</h5>
			<ul>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_phases" class="tsd-kind-icon">WDC Lifecycle and Phases</a>
				</li>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_simulator" class="tsd-kind-icon">Simulator and Samples</a>
				</li>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_library_versions" class="tsd-kind-icon">API Versioning</a>
				</li>
                <li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_hosting_and_submissions" class="tsd-kind-icon">Hosting and Submitting to Community Portal</a>
				</li>
            </ul>
        </li>
        <li>
			<h5>Advanced Concepts</h5>
			<ul>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_custom_init_and_shutdown" class="tsd-kind-icon">Custom Initialization and Shutdown</a>
				</li>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_incremental_refresh" class="tsd-kind-icon">Incremental Refresh</a>
				</li>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_authentication" class="tsd-kind-icon">WDC Authentication</a>
				</li>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_cors" class="tsd-kind-icon">Working with CORS</a>
				</li>
			</ul>
        </li>
        <li>
			<h5>Advanced Tutorials</h5>
			<ul>
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_multi_table_tutorial" class="tsd-kind-icon">Multi Table Tutorial</a>
				</li>
				<!--<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_oauth_tutorial" class="tsd-kind-icon">Node Proxy with OAuth 2.0 Tutorial</a>
				</li>-->
            </ul>
        </li>
        <li>
			<h5>Reference</h5>
			<ul>
				<!--<li class="tsd-kind-property tsd-parent-kind-class">
					<a target="_blank" href="/ref/api_ref" class="tsd-kind-icon">API Reference</a>
                </li>-->
                <li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_ref_date_formats" class="tsd-kind-icon">Supported Date Formats</a>
				</li>
				<!--<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_resources" class="tsd-kind-icon">Resources</a>
				</li>-->
				<li class="tsd-kind-property tsd-parent-kind-class">
					<a href="/docs/wdc_faq" class="tsd-kind-icon">FAQ</a>
				</li>
            </ul>
        </li>
    <ul>
</nav>
<div class="content-wrap docs-content-wrap">
    <h1>WDC Authentication</h1>
    <article class="post">

  <div class="post-content">
    <p>Authentication is one of the more complicated topics related to web data connectors.
Authentication comes in many flavors and can often be one of the most difficult
portions of your connector to get right.  There are a few auth specific components of the
WDC API that you should be aware of.</p>

<ul>
  <li>
    <p><a href="#auth-types">Types of authentication</a></p>
  </li>
  <li>
    <p><a href="#auth-phase">The WDC Auth Phase</a></p>
  </li>
  <li>
    <p><a href="#auth-purpose">Advanced: Auth Purpose Mechanism</a></p>
  </li>
  <li>
    <p><a href="#server-auth">Advanced: Authentication on Server</a></p>
  </li>
</ul>

<h2 id="auth-types">Types of authentication</h2>
<p>There are three types of authentication recognized by the WDC API:</p>

<ul>
  <li><code class="highlighter-rouge">None</code> - for connectors that do not have any authentication needs</li>
  <li><code class="highlighter-rouge">Basic</code> - for connectors that need username/password authentication.</li>
  <li><code class="highlighter-rouge">Custom</code> - for any other type of authentication or authorization (OAuth, as an example).</li>
</ul>

<p>A connector should set its auth type in a custom init method.  For example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  // Init function for connector, called during every phase
  myConnector.init = function(initCallback) {
      tableau.authType = tableau.authTypeEnum.custom;   
  }
</code></pre>
</div>

<p>If a connector does not set its auth type, Tableau will assume that the 
auth type should be <code class="highlighter-rouge">none</code>. For connectors that require authentication, the auth type must be set.  Otherwise,
Tableau will not know how to re-authenticate the user when the user is un-authenticated, which is a common scenario.
For example, passwords (or tokens) should be stored in the tableau.password property.  The contents of this property
are not ever written to disk.  So when a user opens a saved workbook that is attached to a WDC data source,
there will not a be a password for that source.</p>

<p>In that case, if the user wishes to refresh the extract, re-authentication needs to happen first.  When
the user tries to refresh the data source, one of three things can happen depending on the value of authType.</p>

<ul>
  <li>
    <p>If authType is <code class="highlighter-rouge">none</code>, then nothing will happen.</p>
  </li>
  <li>
    <p>If authType is <code class="highlighter-rouge">basic</code>, Tableau will show a standard username/password dialog.</p>

    <p><img class="img-responsive docs-img" src="/assets/wdc_basic_auth.png" alt="" /></p>
  </li>
  <li>
    <p>If authType is <code class="highlighter-rouge">custom</code>, Tableau will launch the web data connector in a special Auth Phase (see the following section).</p>
  </li>
</ul>

<p>After that, the tableau.username and tableau.password property will both have values, and the extract
can now be refreshed.</p>

<p><strong><em>Note</em></strong>: authType in part replaced alwaysShowAuthUI from version 1 of the API.</p>

<h2 id="auth-phase">The WDC Auth Phase</h2>
<p>The WDC has two primary phases, as described in the <a href="/docs/wdc_phases.html">WDC Lifecycle and Phases</a>
section.  But there is a third phase that is only relevant for WDCs that use an auth type of <code class="highlighter-rouge">custom</code>. 
The auth phase is more of an alternative to the interactive phase than a separate phase.</p>

<p>The auth phase will be displayed by Tableau in two scenarios:</p>

<ul>
  <li>
    <p>The WDC uses authType <code class="highlighter-rouge">custom</code>, the current user is un-authenticated (as described above, 
when opening an existing workbook), and the user attempts to refresh the extract or edit the connection.</p>
  </li>
  <li>
    <p>The WDC developer calls <a href="/webdataconnectorapi.tableau.abortforauth">tableau.abortForAuth</a>.</p>

    <p>This method is provided so that the developer can explicitly tell Tableau the current user is un-authenticated.
  For example, this can be helpful when working with OAuth.  In some scenarios, the access token used to get resources
  from an API can expire or be revoked.  In that scenario, before fetching data, the WDC would want to call this method
  in order to re-authenticate the user.  This is an advanced technique, for more details, please see the
  <a href="/docs/wdc_oauth_tutorial">Node Proxy with OAuth Tutorial</a>.</p>
  </li>
</ul>

<p>In the auth phase of the WDC, any changes to properties other than tableau.password and tableau.username will
be ignored.  Thus, it is a best practice to only show the UI that is necessary to re-authenticate the user,
and then auto-submit the connector for the user once they have been authenticated.
For example, in the <a href="/docs/wdc_oauth_tutorial">Node Proxy with OAuth Tutorial</a>, this is how this
is handled in the custom init method:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  // Init function for connector, called during every phase but
  // only called when running inside the simulator or tableau
  myConnector.init = function(initCallback) {
      tableau.authType = tableau.authTypeEnum.custom;

      // If we are in the auth phase we only want to show the UI needed for auth
      if (tableau.phase == tableau.phaseEnum.authPhase) {
        $("#getvenuesbutton").css('display', 'none');
      }

      if (tableau.phase == tableau.phaseEnum.gatherDataPhase) {
        // If API that WDC is using has an enpoint that checks
        // the validity of an access token, that could be used here.
        // Then the WDC can call tableau.abortForAuth if that access token
        // is invalid.
      }

      var accessToken = Cookies.get("accessToken");
      console.log("Access token is '" + accessToken + "'");
      var hasAuth = (accessToken &amp;&amp; accessToken.length &gt; 0) || tableau.password.length &gt; 0;
      updateUIWithAuthState(hasAuth);

      initCallback();

      // If we are not in the data gathering phase, we want to store the token
      // This allows us to access the token in the data gathering phase
      if (tableau.phase == tableau.phaseEnum.interactivePhase || tableau.phase == tableau.phaseEnum.authPhase) {
          if (hasAuth) {
              tableau.password = accessToken;

              if (tableau.phase == tableau.phaseEnum.authPhase) {
                // Auto-submit here if we are in the auth phase
                tableau.submit()
              }

              return;
          }
      }
  };
</code></pre>
</div>

<h2 id="auth-purpose">Advanced: Auth Purpose Mechanism</h2>
<p>Understanding the content in the <a href="/docs/wdc_oauth_tutorial">Node Proxy with OAuth Tutorial</a> is
recommended before proceeding on with this or the following section.  That tutorial contains helpful terminology
that is used without explanation here.</p>

<p>Specifically for data sources that use OAuth as an authorization mechanism, there is a special
enum in the API that can be useful for making a highly scalable connector.  This is an advanced technique
and can be safely ignored in many scenarios.</p>

<p>The motivation for this property stems from the fact that many OAuth providers only allow a limited
number of access tokens to be valid at a given time.  For example, certain OAuth providers allow 25 
access tokens to be valid for a given user/client pair.  If a 26th access token were to be issued, the 1st access
token would become invalid.  For certain OAuth providers, this number may be even smaller.  We have seen OAuth providers that only allow
1 access token to be valid at a given time for any user/client pair.</p>

<p>Given this, the following scenario could occur if the WDC was using a source that only allowed one valid access token:</p>

<ul>
  <li>
    <p>A user creates a data source with your WDC (1 access token is created and associated with that data source).</p>
  </li>
  <li>
    <p>The user publishes the data source to Server and enables automatic refreshes.</p>
  </li>
  <li>
    <p>The user creates a second data source (2nd access token is created, rendering the first one invalid).</p>
  </li>
  <li>
    <p>The automatic refresh on server would now fail because the associated access token is invalid.</p>
  </li>
</ul>

<p>In order to get around this problem, you can associate all data sources created from Tableau Desktop with
a given client, and all data sources refreshed on Tableau Server with another client.  To do this, in your WDC
you can use the <a href="/ref/ref_home.html#webdataconnectorapi.tableau.authpurpose">tableau.authPurpose</a>
to read which context your WDC is currently running in.  If that context is <code class="highlighter-rouge">ephemeral</code> then the WDC is 
being run from Tableau Desktop.  If the context is <code class="highlighter-rouge">enduring</code>, then the WDC is being run on Tableau Server during
an automated refresh.  You can use this property to set the client ID appropriately when performing OAuth flows.</p>

<p>It is also important that your connector sets the tableau.username property to be whatever identity is 
associated with an access token (most commonly an email or username).  This will allow Tableau to share access
tokens between data sources on Server so that even if the OAuth provider restricts you to n valid access tokens, 
you can support more than n data sources.</p>

<h2 id="server-auth">Advanced: Authentication on Server</h2>
<p>Currently, there is no way to re-authenticate a data source from Tableau Server directly.</p>

<p>For example, if you build a connector that uses OAuth as an authorization mechanism, each data source
will have an associated access token.  But these access tokens can expire, 
and when that happens, the data source would no longer be usable.</p>

<p>Luckily, with OAuth (and often there is a parallel with other types of authorization and authentication mechanisms),
there is a way to refresh these access tokens programmatically.  For OAuth specifically, we recommend
fully implementing the refresh flow so that when an access token expires, the refresh token
can be used to get a new, valid access token.</p>

  </div>

</article>

</div>
<script src="/js/api_ref.min.js"></script>
<script src="/js/extra.js"></script>
</body>
</html> 

        
        
    </div> 
  </body>
</html>
